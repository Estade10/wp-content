var bit_conditionals=function(){"use strict";const e=(e,t,r)=>{switch(e){case"and":return t&&r;case"or":return t||r;default:return!1}},t=(e,t,p,m)=>{switch(e.logic){case"equal":return r(e,t,p,m);case"not_equal":return i(e,t,p,m);case"null":return!p&&0===p.length;case"not_null":return p&&p.length>0;case"contain":return n(e,t,p,m);case"contain_all":return l(e,t,p,m);case"not_contain":return s(e,t,p,m);case"greater":return a(e,t,p,m);case"less":return o(e,t,p,m);case"greater_or_equal":return c(e,t,p,m);case"less_or_equal":return d(e,t,p,m);case"start_with":return f(e,t,p,m);case"end_with":return u(e,t,p,m);case"between":return h(e,t,p,m);case"on_click":return!0;default:return!1}},r=(e,t,r,i)=>{if(!t[e.field].value)return!1;if(void 0!==t[e.field].multiple&&t[e.field].multiple||"check"===r||Array.isArray(r)){const e=Array.isArray(r)?r:JSON.parse(r),t=i.split(",");let n=0;return e.forEach((r=>{e.length>0&&-1!==t.indexOf(r)&&(n+=1)})),n===t.length&&t.length===e.length}return r===i},i=(e,t,r,i)=>{if(!r)return!1;if(void 0!==t[e.field].multiple&&t[e.field].multiple||"check"===r||Array.isArray(r)){const e=Array.isArray(r)?r:JSON.parse(r),t=i.split(",");if(e.length!==t.length)return!0;let n=0;return t.forEach((t=>{e.length>0&&-1===e.indexOf(t)&&(n+=1)})),t.length===n}return r!==i},n=(e,t,r,i)=>{if(!r)return!1;const n=i.split(",");let l=0;if(void 0!==t[e.field].multiple&&t[e.field].multiple||"check"===r||Array.isArray(r)){const e=Array.isArray(r)?r:JSON.parse(r);return n.forEach((t=>{e.length>0&&-1!==e.indexOf(t)&&(l+=1)})),l>0}return n.forEach((e=>{r.length>0&&-1!==r.indexOf(e)&&(l+=1)})),l>0},l=(e,t,r,i)=>{if(!r)return!1;const n=i.split(",");let l=0;if(void 0!==t[e.field].multiple&&t[e.field].multiple||"check"===r||Array.isArray(r)){const e=Array.isArray(r)?r:JSON.parse(r);return n.forEach((t=>{e.length>0&&-1!==e.indexOf(t)&&(l+=1)})),l>=n.length}return!1},s=(e,t,r,i)=>{if(!r)return!1;const n=i.split(",");let l=0;if(void 0!==t[e.field].multiple&&t[e.field].multiple||"check"===r||Array.isArray(r)){const e=Array.isArray(r)?r:JSON.parse(r);return n.forEach((t=>{e.length>0&&-1===e.indexOf(t)&&(l+=1)})),l===n.length}return n.forEach((e=>{r.length>0&&-1===r.indexOf(e)&&(l+=1)})),l===n.length},a=(e,t,r,i)=>!!r&&("number"===t[e.field].type?""!==r&&Number(r)>Number(i):""!==r&&r>i),o=(e,t,r,i)=>!!r&&("number"===t[e.field].type?""!==r&&Number(r)<Number(i):""!==r&&r<i),c=(e,t,r,i)=>!!r&&("number"===t[e.field].type?""!==r&&Number(r)>=Number(i):""!==r&&r>=i),d=(e,t,r,i)=>!!r&&("number"===t[e.field].type?""!==r&&Number(r)<=Number(i):""!==r&&r<=i),f=(e,t,r,i)=>!!r&&""!==r&&0===r.indexOf(i),u=(e,t,r,i)=>!!r&&i===r.substr(r.length-i.length,r.length),h=(e,t,r,i)=>{if(!r)return!1;let n=r,l=i.min,s=i.max;return"number"===t[e.field].type&&(n=Number(r),l=Number(i.min),s=Number(i.max)),n>=l&&n<=s},p=e=>e.match(/\([A-Za-z\s0-9+-\\*]*\)/g),m=(e,t,r,i,n)=>{switch(e){case"_bf_length":return t.length;case"_bf_count":return n.match(/check|radio|select/)?t.trim().split(",").length:t.split(/\b\W+\b/g).length;case"_bf_calc":return v(t);case"_bf_math":{const e=t.split(","),n=e[0].substring(2,e[0].length-1);if($(n,i)){const t=checkRepeatedField(n,i),l=getRepeatedIndexes(t,i);let s=0;return void 0===e[1]||"sum"===e[1]?l.forEach((e=>{s+=Number(r[`${n}[${e}]`].value)})):"avg"===e[1]?(l.forEach((e=>{s+=Number(r[`${n}[${e}]`].value)})),s/=l.length):"min"===e[1]?l.forEach((e=>{(0===s||Number(r[`${n}[${e}]`].value)<s)&&(s=Number(r[`${n}[${e}]`].value))})):"max"===e[1]?l.forEach((e=>{Number(r[`${n}[${e}]`].value)>s&&(s=Number(r[`${n}[${e}]`].value))})):"count"===e[1]?s=l.length:"mul"===e[1]&&(s=1,l.forEach((e=>{s*=Number(r[`${n}[${e}]`].value)}))),s}return r[n].value||""}default:return t}},g=(r,i,n,l)=>{if(Array.isArray(r)){let t=!1;for(let s=0;s<r.length;s+=1){const a=r[s];if("string"!=typeof a){const o=g(a,i,n,l);if(0===s&&(t=o),s-1>=0&&"string"==typeof r[s-1]){const i=r[s-1].toLowerCase();t=e(i,t,o)}}}return t}const s=y(r.val,i,n,l),a=Object.entries(n.smartTags).reduce(((e,[t,i])=>({...e,[`\${${t}${"string"==typeof i?"":"()"}}`]:{value:"string"==typeof i?i:i?.[r?.smartKey]||"",type:"text",multiple:!1}})),{}),o={...i,...a},c=$(r.field,n)?`${r.field}[${l}]`:r.field,d={...r,field:c};if(void 0!==o[c]){const e=o[c].value;return t(d,o,e,s)}if(p(r.field)){const e=r.field.substring(2,r.field.length-1).replace(/\([A-Za-z\s0-9+-\\*]*\)/g,""),i=m(e,o[r.smartKey].value,o,n,o[r.smartKey].type);return isNaN(i)?o[r.field]={type:"text"}:o[r.field]={type:"number"},t(r,o,i,s)}return!1},b=(e,t,r,i)=>{let n=e;return(e.match(/\${_bf_math\([^)]+\)}/g)||[]).map((e=>{const i=e.substring(11,e.length-2),l=m("_bf_math",i,t,r);n=n.replace(e,l)})),n.match(/\${\w[^${}]*}/g).map((e=>{let l=e;t[l]||(l=e.substring(2,e.length-1)),l=$(l,r)?`${l}[${i}]`:l;let s="";if(t[l])s=t[l].value,Array.isArray(t[l].value)&&!isNaN(t[l].value[0])&&(s=0,t[l].value.map((e=>{s+=Number(e)})));else if(p(l)){const e=l.replace(/\([A-Za-z\s0-9+-\\*]*\)/g,""),i=l.substring(l.indexOf("(")+1,l.length-1);s=m(e,i,t,r,"")}n=n.replace(e,s)})),n},y=(e,t,r,i)=>{if(!e)return e;let n;if(n="object"==typeof e?JSON.stringify(e):JSON.parse(JSON.stringify(e)),"string"!=typeof n)return e;for(;n.match(/\${\w[^${}]*}/g);)n=b(n,t,r,i);return v(n)},v=e=>{if(!e)return e;let t=e;const r=e.match(/[\\+\-\\*\\/\\%]/g);if(r&&r.length>0){const r=e.match(/\w+/g);if(!r)return e;const i=r.filter((e=>Number.isNaN(e)));if(i&&i.length>0)return t;t=t.replace(/\{|\[/g,"("),t=t.replace(/\}|\]/g,")");try{t=Function(`"use strict"; return (${t})`)()}catch(t){return e}}return t},$=(e,t)=>"undefined"!=typeof checkRepeatedField&&checkRepeatedField(e,t);let _="",x="";const N=(e,t)=>document.querySelector(`#form-${e} ${_} ${t}`),A=(e,t)=>document.querySelectorAll(`#form-${e} ${_} ${t}`),k=(e,t)=>{const r=$(e,t)?`${e}[${x}]`:e;return t.inits&&!t.inits[r]?e:r},w=(e,t,r)=>{const i=t.fields[e],{fieldName:n,typ:l}=i,s=k(e,t);if(t.inits&&t.inits[s])t.inits[s].disabled=r;else{if("check"===l)return void A(t.contentId,`input[name="${n}[]"]`).forEach((e=>{e.disabled=r}));if("radio"===l)return void A(t.contentId,`input[name="${n}"]`).forEach((e=>{e.disabled=r}));if("decision-box"===l){const e=N(t.contentId,`input[name="${n}"]`);return void(e&&(e.disabled=r))}if("button"===l)return void(N(t.contentId,`.${e}-btn`).disabled=r);N(t.contentId,`.${e}-fld`).disabled=r}},I=(e,t,r)=>{const i=k(e,t);t.inits&&t.inits[i]?t.inits[i].readonly=r:N(t.contentId,`.${e}-fld`).readOnly=r},O=e=>{const t=window.getComputedStyle(e);let r=0;return r="border-box"===t.boxSizing?e.scrollHeight:parseInt(t.paddingTop)+parseInt(t.paddingBottom)+e.scrollHeight+parseInt(t.marginTop)+parseInt(t.marginBottom)+parseInt(t.borderTopWidth)+parseInt(t.borderBottomWidth),r},E=(e,t,r)=>{if(t.fields[e.field]){t.fields[e.field].valid.hide=r;const i=e.field,n=N(t.contentId,`.btcd-fld-itm.${i}`);let l=O(n);setStyleProperty(n,"height",`${l}px`),r?(setStyleProperty(n,"height","0px"),n.classList.add("fld-hide")):(n.classList.remove("fld-hide"),l=O(n),setStyleProperty(n,"height",`${l}px`)),setTimeout((()=>{n.style.removeProperty("height")}),300)}},S=(e,t,r,i,n)=>{if(x=n,_=n&&$(e.field,r)?`.rpt-index-${n}`:"",void 0!==e.action&&void 0!==e.field)switch(e.field in r.fields&&!r.fields[e.field].valid&&(r.fields[e.field].valid={}),e.action){case"value":return((e,t,r)=>{const i=e.val?y(e.val,r,t,x):"";void 0!==e.val&&t.fields[e.field]?((e,t,r)=>{const{contentId:i}=e,n=e.fields[t],{fieldName:l,typ:s}=n;if("radio"===s)return void(N(i,`input[name="${l}"][value="${r}"]`).checked=!0);if("check"===s){const t=new RegExp(`,|${e.configs.bf_separator}`,"g"),n=r.split(t);return void A(i,`input[name="${l}[]"]`).forEach((e=>{e.checked=n.includes(e.value)}))}if("decision-box"===s){const e=N(i,`input[name="${l}"]`);return void(e&&(e.checked=r===n.msg.checked))}if("rating"===s){const i=k(t,e);return void(e.inits&&e.inits[i]&&(e.inits[i].value=r))}const a=N(i,`[name^='${l}']`);a.value!==r&&(a.value=r,a.setAttribute("value",r))})(t,e.field,i):void 0!==e.val&&"_bf_step_no"===e.field&&t?.inits?.multi_step_form&&(t.inits.multi_step_form.step=i)})(e,r,i);case"hide":return E(e,r,!0);case"disable":r.fields[e.field]&&w(e.field,r,!0);break;case"readonly":r.fields[e.field]&&I(e.field,r,!0);break;case"writeable":r.fields[e.field]&&I(e.field,r,!1);break;case"enable":r.fields[e.field]&&w(e.field,r,!1);break;case"show":if(r.fields[e.field])return E(e,r,!1);break;case"activelist":r.fields[e.field]&&((e,t,r)=>{const i=k(e.field,t);if(t.inits&&t.inits[i]){const n=e.val?y(e.val,r,t,x):"";t.inits[i].activelist=n}})(e,r,i);break;case"save_draft":"_bf_form"===e.field&&((e,t)=>{"undefined"!=typeof saveFormProgress&&saveFormProgress(t.contentId)})(0,r);break;case"lbl":case"ct":case"sub-titl":case"hlp-txt":case"title":r.fields[e.field]&&((e,t,r)=>{if(void 0!==e.val&&t.fields[e.field]){const i=e.val?y(e.val,r,t,x):"",n=e.field,l=N(t.contentId,`.${n}-${e.action}`);if(null===l)return;l.childNodes.forEach((e=>{3!==e.nodeType||""===e.textContent.trim()&&e.length||(e.textContent=i)})),"ct"===e.action&&(l.textContent=i)}})(e,r,i)}},F=(e,t)=>Object.keys(t).find((r=>t[r].fieldName===e)),j=e=>e.replace(/\[\d*\]/g,"");function C(e,t){return Array.isArray(e)?e.some((e=>C(e,t))):"object"==typeof e&&e.field===t}return function(e){if(!e?.target?.form)return;const t=e.target,{form:r}=e.target,i=r.id.replace("form-",""),n=window.bf_globals?.[i];if(!n)return;const l=t.name.match(/\[(\d+)\]/)?.[1],s=j(t.name),a=F(s,n.fields);if(!a)return;const o=((e,t)=>{const r=new FormData(e),{fields:i}=t,n={};return Array.from(r.entries()).forEach((([e,t])=>{const r=F(j(e),i),l=e.match(/\[(\d+)\]/)?.[1],s=l?`${r}[${l}]`:r;r in i&&(n[s]?(Array.isArray(n[s])||(n[s]=[n[s]]),n[s].push(t)):n[s]=t)})),Object.keys(i).filter((e=>"button"===i[e].typ)).forEach((e=>{n[e]=""})),Object.entries(n).reduce(((e,[t,r])=>({...e,[t]:{value:r,type:i[t.replace(/\[\d*\]/g,"")].typ,multiple:Array.isArray(r)}})),{})})(r,n),c=[],{onfieldCondition:d}=n;if(!d)return;const f=d.filter((e=>"on_input"===e.event_type)).filter((e=>e.conditions.some((e=>C(e?.logics,a)))));if(!f.length)return;f.forEach(((e,t)=>{const{conditions:r}=e,{length:i}=r;let s=!1,d=!!l&&[l];l||"undefined"==typeof getIndexesBaseOnConditions||(d=getIndexesBaseOnConditions(r,n));let f=!!d&&d.pop();do{let e=0;for(e=0;e<i;e+=1){const t=r[e];if(["if","else-if"].includes(t.cond_type)){const{logics:e}=t,r=e.filter((e=>"on_click"===e.logic));if(r.length&&a!==r[0].field)return!1;if(s=g(e,o,n,f),s)break}}c.push({workflowIndx:t,condIndx:e,logicStatus:s,rowIndex:f}),f=!!d&&d.pop()}while(f)}));const u={};return c.reverse(),c.forEach((({workflowIndx:e,condIndx:t,logicStatus:r,rowIndex:i})=>{const{conditions:l}=f[e],s=l.find((e=>"else"===e.cond_type))||{},a=r?l[t].actions:s.actions;a?.fields?.forEach((e=>{let t=[i];i||(t=function(e,t){if("undefined"!=typeof checkRepeatedField){const r=checkRepeatedField(e,t);if(r)return getRepeatedIndexes(r,t)}return!1}(e.field,n)),t||(t=[""]),t.forEach((t=>{const r=`${e.field}[${t}]`;if(u[r]||(u[r]=[]),!u[r].includes(e.action)){u[r].push(e.action);const i=Object.entries(n.smartTags).reduce(((e,[t,r])=>({...e,[`\${${t}}`]:{value:r,type:"text",multiple:!1}})),{});S(e,0,n,{...o,...i},t)}}))}))})),Object.keys(u).length}}();
